<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/dataTables.bootstrap.min.css">
<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
</head>
<body>
	<div>
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div>
				<header style="height: 100%">
					<div align="left">
						<table style="width: 100%">
							<tr>
								<td>
									<form class="form-inline" onsubmit="return false">
										<div class="form-group">
											       手机号： <input id="mobile" type="text" class="form-control"
												placeholder="mobile">
												姓名： <input id="name" type="text" class="form-control"
												placeholder="name">
												身份证号： <input id="identityCard" type="text" class="form-control"
												placeholder="identityCard">
												出生日期： <input id="birthday" type="text" class="form-control"
												placeholder="birthday">
												<!-- 借款合同号： <input id="orderGid" type="text" class="form-control"
												placeholder="orderGid"> -->
											<button id="searchBt" class="layui-btn layui-btn-sm">
												<i class="layui-icon">&#xe615;</i>搜索
											</button>
										</div>
									</form>
								</td>

							</tr>
						</table>
					</div>
				</header>

				<div>
					<div class="widget-body no-padding">
					    <!-- 基本信息 -->
						<table id="dt-table"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th>用户gid</th>
									<th>姓名</th>
									<th>手机号</th>
									<th>身份证号</th>
									<th>用户状态</th>
									<th>用户总额度</th>
									<th>出生日期</th>
									<th>性别</th>
									<th>学历</th>
									<th>婚姻状况</th>
									<th>居住地</th>
									<th>每月收入</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 紧急联系人信息 -->
						<div id="contact" class="widget-body no-padding" style="display:none;">
						<table id="dt-table2"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<!-- <tr>
									<th>主要联系人关系</th>
									<th>主要联系人姓名</th>
									<th>主要联系人电话</th>
									<th>备用联系人关系</th>
									<th>备用联系人姓名</th>
									<th>备用联系人电话</th>
									<th>正面照</th>
									<th>反面照</th>
									<th>手持照</th>
									<th>操作</th>
								</tr> -->
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 借款记录 -->
					<div id="loan" class="widget-body no-padding" style="display:none;">
						<table id="dt-table3"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th>借款gid</th>
									<th>订单号/合同号</th>
									<th>借款时间</th>
									<th>借款金额</th>
									<th>借款状态</th>
									<th>最后一次还款时间</th>
									<th>借款天数</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 还款记录 -->
					<div id="repay" class="widget-body no-padding" style="display:none;">
						<table id="dt-table4"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th>订单号/合同号</th>
									<th>还款金额</th>
									<th>还款时间</th>
									<th>还款状态</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				    <!-- 银行卡记录 -->
					<div id="bank" class="widget-body no-padding" style="display:none;">
						<table id="dt-table5"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th>银行编号</th>
									<th>银行名</th>
									<th>银行卡号</th>
									<th>银行卡绑卡时间</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				</div>
			</div>
		</div>
	</div>
</body>
</html>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript"
	src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript"
	src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript">
var pers = checkPermission();
var photoDomain = window.location.protocol + "//" + window.location.host + "/statics";

var example;
var example2;
var example3;
var example4;
var example5;
function init(){
	example =
    	$('#dt-table').DataTable({
        	"searching": false,
        	"processing": false,
        	"serverSide" : true,
        	"language": {
                "url": "/js/plugin/datatables/Chinese.lang"
            },
        	"ajax": {
        		//"url" : "/dicts",
        		"url" : "/customer/listBasicInfos",
        		"type":"get",
        		"data":function(d){
        			d.mobile = $("#mobile").val();
        			d.name = $("#name").val();
        			d.identityCard = $("#identityCard").val();
        			d.birthday = $("#birthday").val();
        			d.orderGid = $("#orderGid").val();
    			},
    			"error":function(xhr, textStatus, errorThrown){
    				var msg = xhr.responseText;
    				console.log(msg);
    				var response = JSON.parse(msg);
    				var code = response.code;
    				var message = response.message;
    				if (code == 400) {
    					layer.msg(message);
    				} else if (code == 401) {
    					localStorage.removeItem("token");
    					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
    						location.href = '/login.html';
                        });
    				} else if (code == 403) {
    					console.log("未授权:" + message);
    					layer.msg('未授权');
    				} else if (code == 500) {
    					layer.msg('系统错误：' + message);
    				}
    			}
        	},
        	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
            "columns": [
				{"data" : "userGid", "defaultContent" : "","visible": false},
				{"data" : "name", "defaultContent" : ""},
				{"data" : "phone", "defaultContent" : ""},
				{"data" : "identityCard", "defaultContent" : ""},
				{"data" : "userStatus", "defaultContent" : ""},
				{"data" : "creditLine", "defaultContent" : ""},
				{"data" : "birthday", "defaultContent" : ""},
				{"data" : "sex", "defaultContent" : ""},
				{"data" : "education", "defaultContent" : ""},
				{"data" : "marital", "defaultContent" : ""},
				{"data" : "place", "defaultContent" : ""},
				{"data" : "income", "defaultContent" : ""},
				{
					"data": "",
					"defaultContent": "",
					"orderable":false,
			        "render": function (data, type, row) {
             		          var gid = row['userGid'];
             		          var button1="<button id='editrow1' class='btn btn-success' type='button'  onclick='showContact("+'\"'+gid+'\"'+")' >联系人<i class='fa fa-edit'></i></button>&nbsp;";
             		          var button2="<button id='editrow2' class='btn btn-success' type='button'  onclick='showLoan("+'\"'+gid+'\"'+")' >借款记录<i class='fa fa-edit'></i></button>&nbsp;";
             		          var button3="<button id='editrow3' class='btn btn-success' type='button'  onclick='showRepay("+'\"'+gid+'\"'+")' >还款记录<i class='fa fa-edit'></i></button>&nbsp;";
             		          var button4="<button id='editrow4' class='btn btn-success' type='button'  onclick='showBank("+'\"'+gid+'\"'+")' >银行卡信息<i class='fa fa-edit'></i></button>&nbsp;";
             		        return  button1+button2+button3+button4;
			        }
				},

            ],
           "order": [[ 1, "asc" ]]
        } );
}

/* layui.use('layer', function(){
    var layer = layui.layer;
}); */

//加载时间插件
layui.use(['layer','laydate'], function(){
    var layer = layui.layer;
    var laydate = layui.laydate;
    laydate.render({
       elem: '#birthday'
    });

});


$("#searchBt").click(function(){
	example.ajax.reload();
	$('#dt-table2 tbody').empty();
	//$("#contact").css("display","none");
	$('#dt-table3 tbody').empty();
	$('#dt-table4 tbody').empty();
	$('#dt-table5 tbody').empty();
});

//查看紧急联系人信息
function showContact(gid){
	$("#contact").css("display","block");
	$("#dt-table2 thead").html("<tr><th>主要联系人关系</th><th>主要联系人姓名</th><th>主要联系人电话</th><th>备用联系人关系</th><th>备用联系人姓名</th><th>备用联系人电话</th><th>正面照</th><th>反面照</th><th>手持照</th><th>操作</th></tr>");
	$('#dt-table2 tbody').empty();

	example2=
	$('#dt-table2').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,  //防止重新加载dataTable时出现警告：destroy/retrieve
    	"language": {
            "url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/customer/listContactInfos",
    		"type":"get",
    		"data":{"userGid":gid},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "majorRelationship", "defaultContent" : ""},
			{"data" : "majorName", "defaultContent" : ""},
			{"data" : "majorPhone", "defaultContent" : ""},
			{"data" : "bakRelationship", "defaultContent" : ""},
			{"data" : "bakName", "defaultContent" : ""},
			{"data" : "bakPhone", "defaultContent" : ""},
			{"data" : "photo1Url", "defaultContent" : "正面照", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + '点击链接查看正面照' + '</a>';
				}else{
					return '<a href="#">'+"没有上传正面照"+'</a>';
				}
			  }
			},
			{"data" : "photo2Url", "defaultContent" : "反面照", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + '点击链接查看反面照' + '</a>';
				}else{
					return '<a href="#">'+"没有上传反面照"+'</a>';
				}
			  }
			},
			{"data" : "photo3Url", "defaultContent" : "手持照", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + '点击链接查看手持照' + '</a>';
				}else{
					return '<a href="#">'+"没有上传手持照"+'</a>';
				}
			  }
			},
			{
				"data": "",
				"defaultContent": "",
				"visible": false,
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

	//修改请求参数后再重新加载数据-解决上述ajax请求只能调用一次的问题
    var param = {
        "userGid": gid,
    };
    example2.settings()[0].ajax.data = param;
    example2.ajax.reload();
}

function showLoan(gid){
	$("#loan").css("display","block");
	$('#dt-table3 tbody').empty();
	example3=
	$('#dt-table3').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            "url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/customer/listLoans",
    		"type":"get",
    		"data":{"userGid":gid},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "gid", "defaultContent" : ""},
			{"data" : "orderId", "defaultContent" : ""},
			{"data" : "loanTime", "defaultContent" : ""},
			{"data" : "loanAmount", "defaultContent" : ""},
			{"data" : "loanStatus", "defaultContent" : ""},
			{"data" : "lastRepaymentTime", "defaultContent" : ""},
			{"data" : "loanPeriod", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

	    var param = {
	        "userGid": gid,
	    };
	    example3.settings()[0].ajax.data = param;
	    example3.ajax.reload();
}

function showRepay(gid){
	$("#repay").css("display","block");
	$('#dt-table4 tbody').empty();
	example4=
	$('#dt-table4').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            "url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/customer/listRepays",
    		"type":"get",
    		"data":{"userGid":gid},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "orderId", "defaultContent" : ""},
			{"data" : "repaymentAmount", "defaultContent" : ""},
			{"data" : "endTime", "defaultContent" : ""},
			{"data" : "repaymentStatus", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

        var param = {
            "userGid": gid,
        };
        example4.settings()[0].ajax.data = param;
        example4.ajax.reload();
}

function showBank(gid){
	$("#bank").css("display","block");
	$('#dt-table5 tbody').empty();
	example5=
	$('#dt-table5').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            "url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/customer/listBanks",
    		"type":"get",
    		"data":{"userGid":gid},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "bankNo", "defaultContent" : ""},
			{"data" : "bankName", "defaultContent" : ""},
			{"data" : "cardNo", "defaultContent" : ""},
			{"data" : "createTime", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

        var param = {
            "userGid": gid,
        };
        example2.settings()[0].ajax.data = param;
        example2.ajax.reload();
}

init();
</script>
