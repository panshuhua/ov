<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/dataTables.bootstrap.min.css">
<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
</head>
<body>
	<div>
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div>
				<header style="height: 100%">
					<div align="left">
						<table style="width: 100%">
							<tr>
								<td>
									<form class="form-inline" onsubmit="return false">
										<div class="form-group">
										        <span class="phone"></span>:
											    <input id="mobile" type="text" class="form-control"
												placeholder="mobile">
												<span class="name"></span>:
												<input id="name" type="text" class="form-control"
												placeholder="name">
												<span class="identityCard"></span>： <input id="identityCard" type="text" class="form-control"
												placeholder="identityCard">
												<span class="birthday"></span>: <input id="birthday" type="text" class="form-control"
												placeholder="birthday">
												<!-- 借款合同号： <input id="orderGid" type="text" class="form-control"
												placeholder="orderGid"> -->
											<button id="searchBt" class="layui-btn layui-btn-sm">
												<i class="layui-icon">&#xe615;</i><span class="search"></span>
											</button>
										    
										</div>
									</form>
								</td>

							</tr>
						</table>
					</div>
				</header>

				<div>
					<div class="widget-body no-padding">
					    <!-- 基本信息 -->
						<table id="dt-table"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th>用户gid</th>
									<th><span class="name"></span></th>
									<th><span class="phone"></span></th>
									<th><span class="identityCard"></span></th>
									<th><span class="userStatus"></span></th>
									<th><span class="creditLine"></span></th>
									<th><span class="birthday"></span></th>
									<th><span class="sex"></span></th>
									<th><span class="education"></span></th>
									<th><span class="marital"></span></th>
									<th><span class="place"></span></th>
									<th><span class="income"></span></th>
									<th><span class="operation"></span></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 紧急联系人信息 -->
						<div id="contact" class="widget-body no-padding" style="display:none;">
						<table id="dt-table2"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
									<th><span class="majorRelationship"></span></th>
									<th><span class="majorName"></span></th>
									<th><span class="majorPhone"></span></th>
									<th><span class="bakRelationship"></span></th>
									<th><span class="bakName"></span></th>
									<th><span class="bakPhone"></span></th>
									<th><span class="photo1Url"></span></th>
									<th><span class="photo2Url"></span></th>
									<th><span class="photo3Url"></span></th>
									<th><span class="operation"></span></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 借款记录 -->
					<div id="loan" class="widget-body no-padding" style="display:none;">
						<table id="dt-table3"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th><span class="borrowgid"></span></th>
									<th><span class="orderId"></span></th>
									<th><span class="loanTime"></span></th>
									<th><span class="loanAmount"></span></th>
									<th><span class="loanStatus"></span></th>
									<th><span class="lastRepaymentTime"></span></th>
									<th><span class="loanPeriod"></span></th>
									<th><span class="operation"></span></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

					<!-- 还款记录 -->
					<div id="repay" class="widget-body no-padding" style="display:none;">
						<table id="dt-table4"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th><span class="orderId"></span></th>
									<th><span class="repaymentAmount"></span></th>
									<th><span class="endTime"></span></th>
									<th><span class="repaymentStatus"></span></th>
									<th><span class="operation"></span></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				    <!-- 银行卡记录 -->
					<div id="bank" class="widget-body no-padding" style="display:none;">
						<table id="dt-table5"
							class="table table-striped table-bordered table-hover"
							style="width: 100%">
							<thead>
								<tr>
								</tr>
								<tr>
									<th><span class="bankNo"></span></th>
									<th><span class="bankName"></span></th>
									<th><span class="cardNo"></span></th>
									<th><span class="tiedTime"></span></th>
									<th><span class="operation"></span></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				</div>
			</div>
		</div>
	</div>
</body>
</html>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript"
	src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript"
	src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript" src="../../js/jquery.i18n.properties-1.0.9.js"></script>
<script type="text/javascript">

var lang="en";

loadProperties(lang);

function loadProperties(types) {
	 $.i18n.properties({
		 name:'messages',    //属性文件名     命名格式： 文件名_国家代号.properties
		 path:'i18n/',   //注意这里路径是你属性文件的所在文件夹
		 mode:'map',
		 language:types,     //这就是国家代号 name+language刚好组成属性文件名：strings+zh -> strings_zh.properties
		 callback:function(){
			$('.phone').html($.i18n.prop('customer.phone'));
			$('.name').html($.i18n.prop('customer.name'));
			$('.identityCard').html($.i18n.prop('customer.identityCard'));
			$('.birthday').html($.i18n.prop('customer.birthday'));
			$('.search').html($.i18n.prop('customer.search'));
			$('.language').html($.i18n.prop('customer.language'));
			$('.userStatus').html($.i18n.prop('customer.userStatus'));
			$('.creditLine').html($.i18n.prop('customer.creditLine'));
			$('.sex').html($.i18n.prop('customer.sex'));
			$('.education').html($.i18n.prop('customer.education'));
			$('.marital').html($.i18n.prop('customer.marital'));
			$('.place').html($.i18n.prop('customer.place'));
			$('.income').html($.i18n.prop('customer.income'));
			$('.operation').html($.i18n.prop('customer.operation'));
			$('.majorName').html($.i18n.prop('customer.majorName'));
			$('.majorPhone').html($.i18n.prop('customer.majorPhone'));
			$('.bakRelationship').html($.i18n.prop('customer.bakRelationship'));
			$('.bakName').html($.i18n.prop('customer.bakName'));
			$('.bakPhone').html($.i18n.prop('customer.bakPhone'));
			$('.photo1Url').html($.i18n.prop('customer.photo1Url'));
			$('.photo2Url').html($.i18n.prop('customer.photo2Url'));
			$('.photo3Url').html($.i18n.prop('customer.photo3Url'));
			$('.borrowgid').html($.i18n.prop('customer.borrowgid'));
			$('.orderId').html($.i18n.prop('customer.orderId'));
			$('.loanTime').html($.i18n.prop('customer.loanTime'));
			$('.loanAmount').html($.i18n.prop('customer.loanAmount'));
			$('.loanStatus').html($.i18n.prop('customer.loanStatus'));
			$('.lastRepaymentTime').html($.i18n.prop('customer.lastRepaymentTime'));
			$('.loanPeriod').html($.i18n.prop('customer.loanPeriod'));
			$('.repaymentAmount').html($.i18n.prop('customer.repaymentAmount'));
			$('.endTime').html($.i18n.prop('customer.endTime'));
			$('.repaymentStatus').html($.i18n.prop('customer.repaymentStatus'));
			$('.bankNo').html($.i18n.prop('customer.bankNo'));
			$('.bankName').html($.i18n.prop('customer.bankName'));
			$('.cardNo').html($.i18n.prop('customer.cardNo'));
			$('.tiedTime').html($.i18n.prop('customer.tiedTime'));
			$('.contacts').html($.i18n.prop('customer.contacts'));
			$('.borrowRecord').html($.i18n.prop('customer.borrowRecord'));
			$('.repaymentRecord').html($.i18n.prop('customer.repaymentRecord'));
			$('.bankcardInfo').html($.i18n.prop('customer.bankcardInfo'));
		 }
	 });
	 
}

function loadProperties1(types) {
	 $.i18n.properties({
		 name:'messages',    //属性文件名     命名格式： 文件名_国家代号.properties
		 path:'i18n/',   //注意这里路径是你属性文件的所在文件夹
		 mode:'map',
		 language:types,     //这就是国家代号 name+language刚好组成属性文件名：strings+zh -> strings_zh.properties
		 callback:function(){
			$('.contacts').html($.i18n.prop('customer.contacts'));
			$('.borrowRecord').html($.i18n.prop('customer.borrowRecord'));
			$('.repaymentRecord').html($.i18n.prop('customer.repaymentRecord'));
			$('.bankcardInfo').html($.i18n.prop('customer.bankcardInfo'));
		 }
	 });
}

//切换语言
$("#lang").on('change',function(){
	sessionStorage.setItem("lang",$(this).val());
	loadProperties($(this).val());
	init();
});

var pers = checkPermission();
var photoDomain = window.location.protocol + "//" + window.location.host + "/statics";

var example;
var example2;
var example3;
var example4;
var example5;
function init(){
	example =
    	$('#dt-table').DataTable({
        	"searching": false,
        	"processing": false,
        	"serverSide" : true,
        	"retrieve":true,
        	"language": {
            },
        	"ajax": {
        		"url" : "/manage/customer/listBasicInfos",
        		"type":"get",
        		"data":function(d){
        			d.mobile = $("#mobile").val();
        			d.name = $("#name").val();
        			d.identityCard = $("#identityCard").val();
        			d.birthday = $("#birthday").val();
        			d.orderGid = $("#orderGid").val();
        			d.lang=lang;
    			},
    			"error":function(xhr, textStatus, errorThrown){
    				var msg = xhr.responseText;
    				console.log(msg);
    				var response = JSON.parse(msg);
    				var code = response.code;
    				var message = response.message;
    				if (code == 400) {
    					layer.msg(message);
    				} else if (code == 401) {
    					localStorage.removeItem("token");
    					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
    						location.href = '/login.html';
                        });
    				} else if (code == 403) {
    					console.log("未授权:" + message);
    					layer.msg('未授权');
    				} else if (code == 500) {
    					layer.msg('系统错误：' + message);
    				}
    			}
        	},
        	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
            "columns": [
				{"data" : "userGid", "defaultContent" : "","visible": false},
				{"data" : "name", "defaultContent" : ""},
				{"data" : "phone", "defaultContent" : ""},
				{"data" : "identityCard", "defaultContent" : ""},
				{"data" : "userStatus", "defaultContent" : ""},
				{"data" : "creditLine", "defaultContent" : ""},
				{"data" : "birthday", "defaultContent" : ""},
				{"data" : "sex", "defaultContent" : ""},
				{"data" : "education", "defaultContent" : ""},
				{"data" : "marital", "defaultContent" : ""},
				{"data" : "place", "defaultContent" : ""},
				{"data" : "income", "defaultContent" : ""},
				{
					"data": "",
					"defaultContent": "",
					"orderable":false,
			        "render": function (data, type, row) {
             		          var gid = row['userGid'];
             		          var button1="<button id='editrow1' class='btn btn-success' type='button'  onclick='showContact("+'\"'+gid+'\"'+")' >contacts<i class='fa fa-edit'></i></button>&nbsp;";
             		          var button2="<button id='editrow2' class='btn btn-success' type='button'  onclick='showLoan("+'\"'+gid+'\"'+")'>borrowRecord</span><i class='fa fa-edit'></i></button>&nbsp;";
             		          var button3="<button id='editrow3' class='btn btn-success' type='button'  onclick='showRepay("+'\"'+gid+'\"'+")'>repaymentRecord</span><i class='fa fa-edit'></i></button>&nbsp;";
             		          var button4="<button id='editrow4' class='btn btn-success' type='button'  onclick='showBank("+'\"'+gid+'\"'+")'>bankcardInfo<i class='fa fa-edit'></i></button>&nbsp;";
             		        return  button1+button2+button3+button4;
			        }
				},

            ],
           "order": [[ 1, "asc" ]]
        } );
	
	//修改请求参数后再重新加载数据-解决上述ajax请求只能调用一次的问题
    /* var param = {
        "lang":lang,
        "mobile":$("#mobile").val(),
        "name":$("#name").val(),
        "identityCard":$("#identityCard").val(),
        "birthday":$("#birthday").val(),
	    "orderGid":$("#orderGid").val(),
    };
    example.settings()[0].ajax.data = param;
    example.ajax.reload(); */
}

/* layui.use('layer', function(){
    var layer = layui.layer;
}); */

//加载时间插件
layui.use(['layer','laydate'], function(){
    var layer = layui.layer;
    var laydate = layui.laydate;
    laydate.render({
       elem: '#birthday'
    });

});


$("#searchBt").click(function(){
	example.ajax.reload();
	$('#dt-table2 tbody').empty();
	//$("#contact").css("display","none");
	$('#dt-table3 tbody').empty();
	$('#dt-table4 tbody').empty();
	$('#dt-table5 tbody').empty();
});

//查看紧急联系人信息
function showContact(gid){
	$("#contact").css("display","block");
	$('#dt-table2 tbody').empty();
    
	example2=
	$('#dt-table2').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,  //防止重新加载dataTable时出现警告：destroy/retrieve
    	"language": {
            //"url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/manage/customer/listContactInfos",
    		"type":"get",
    		"data":{"userGid":gid,"lang":lang},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "majorRelationship", "defaultContent" : ""},
			{"data" : "majorName", "defaultContent" : ""},
			{"data" : "majorPhone", "defaultContent" : ""},
			{"data" : "bakRelationship", "defaultContent" : ""},
			{"data" : "bakName", "defaultContent" : ""},
			{"data" : "bakPhone", "defaultContent" : ""},
			{"data" : "photo1Url", "defaultContent" : "front photo", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + 'view  front photo' + '</a>';
				}else{
					return '<a href="#">'+"No positive photo were uploaded"+'</a>';
				}
			  }
			},
			{"data" : "photo2Url", "defaultContent" : "reverse photo", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + 'view reverse photo' + '</a>';
				}else{
					return '<a href="#">'+"No reverse photo were uploaded"+'</a>';
				}
			  }
			},
			{"data" : "photo3Url", "defaultContent" : "handheld photo", render: function(data, type, row) {
				if(data!='' & data!=null){
					return '<a href="'+photoDomain+data+'"'+'target="_blank"'+'>' + 'view handheld photo' + '</a>';
				}else{
					return '<a href="#">'+"No handheld photos were uploaded"+'</a>';
				}
			  }
			},
			{
				"data": "",
				"defaultContent": "",
				"visible": false,
				"orderable":false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

	//修改请求参数后再重新加载数据-解决上述ajax请求只能调用一次的问题
    var param = {
        "userGid": gid,
        "lang":lang,
    };
    example2.settings()[0].ajax.data = param;
    example2.ajax.reload();
}

function showLoan(gid){
	$("#loan").css("display","block");
	$('#dt-table3 tbody').empty();
	 
	example3=
	$('#dt-table3').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            //"url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/manage/customer/listLoans",
    		"type":"get",
    		"data":{"userGid":gid,"lang":lang},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "gid", "defaultContent" : ""},
			{"data" : "orderId", "defaultContent" : ""},
			{"data" : "loanTime", "defaultContent" : ""},
			{"data" : "loanAmount", "defaultContent" : ""},
			{"data" : "loanStatus", "defaultContent" : ""},
			{"data" : "lastRepaymentTime", "defaultContent" : ""},
			{"data" : "loanPeriod", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

	    var param = {
	        "userGid": gid,
	        "lang":lang,
	    };
	    example3.settings()[0].ajax.data = param;
	    example3.ajax.reload();
}

function showRepay(gid){
	$("#repay").css("display","block");
	$('#dt-table4 tbody').empty();
	
	example4=
	$('#dt-table4').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            //"url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/manage/customer/listRepays",
    		"type":"get",
    		"data":{"userGid":gid,"lang":lang},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "orderId", "defaultContent" : ""},
			{"data" : "repaymentAmount", "defaultContent" : ""},
			{"data" : "endTime", "defaultContent" : ""},
			{"data" : "repaymentStatus", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

        var param = {
            "userGid": gid,
            "lang":lang,
        };
        example4.settings()[0].ajax.data = param;
        example4.ajax.reload();
}

function showBank(gid){
	$("#bank").css("display","block");
	$('#dt-table5 tbody').empty();
	
	example5=
	$('#dt-table5').DataTable({
    	"searching": false,
    	"processing": false,
    	"serverSide" : true,
    	"retrieve":true,
    	"language": {
            //"url": "/js/plugin/datatables/Chinese.lang"
        },
    	"ajax": {
    		"url" : "/manage/customer/listBanks",
    		"type":"get",
    		"data":{"userGid":gid,"lang":lang},
			"error":function(xhr, textStatus, errorThrown){
				var msg = xhr.responseText;
				console.log(msg);
				var response = JSON.parse(msg);
				var code = response.code;
				var message = response.message;
				if (code == 400) {
					layer.msg(message);
				} else if (code == 401) {
					localStorage.removeItem("token");
					layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
						location.href = '/login.html';
                    });
				} else if (code == 403) {
					console.log("未授权:" + message);
					layer.msg('未授权');
				} else if (code == 500) {
					layer.msg('系统错误：' + message);
				}
			}
    	},
    	"dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
        "columns": [
			{"data" : "bankNo", "defaultContent" : ""},
			{"data" : "bankName", "defaultContent" : ""},
			{"data" : "cardNo", "defaultContent" : ""},
			{"data" : "createTime", "defaultContent" : ""},
			{
				"data": "",
				"defaultContent": "",
				"orderable":false,
				"visible": false,
		        "render": function (data, type, row) {
         		           var id = row['id'];
           	              return null;
		         }
			},

        ],
       "order": [[ 1, "asc" ]]
    } );

        var param = {
            "userGid": gid,
            "lang":lang,
        };
        example2.settings()[0].ajax.data = param;
        example2.ajax.reload();
}

init();

</script>
